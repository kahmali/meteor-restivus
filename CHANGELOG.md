# Change Log

## [Unreleased]

#### Warning - Potentially breaking change
- Restivus used to store the account login token in the user document: `services.resume.loginTokens.token`
- Restivus now stores the account login token as a hashed token, in the user document: `services.resume.loginTokens.hashedToken`
- This means that all clients consuming a Restivus API will need to reauthenticate with their 
  username/email and password after this update, as their existing tokens will be rendered invalid.

#### Changed
- Update default auth endpoints to match current Accounts token storage (see #79)
  - Login token is now stored as `hashedToken` instead of `token`
- Return `401 Unauthorized` for failed authentication
- When logging in with bad credentials, randomly delay the response (See #81)
  

## [v0.6.6] - 2015-05-25

#### Fixed
- Issue #68:
  - Make Restivus a server-only package (`Restivus` is now `undefined` on the client)
  
#### Changed
- Improve the Contributing Guidelines
  - Tighten up some conventions
  - Add more detailed information


## [v0.6.5] - 2015-04-27

#### Fixed
- Issue #32:
  - Prevent non-JSON response types from being wrapped in quotes
  - This bug required clients to do additional parsing of non-JSON types (removing quotes and 
    escaped characters)

#### Added
- Include an endpoint's configuration options [in its context]
  (https://github.com/kahmali/meteor-restivus#thisendpointoption)
- Allow [default response headers](https://github.com/kahmali/meteor-restivus#defaultheaders) to be 
  configured
- Allow CORS to be disabled in API config (using [`enableCors`]
  (https://github.com/kahmali/meteor-restivus#enablecors) option)
    - Resolves Issue #39
    
#### Changed
- Default response Content-Type is now `application/json` instead of `text/json`
  - This _shouldn't_ have any effect on existing APIs. Updating to match standard JSON type, 
    according to [RFC 4627](http://www.ietf.org/rfc/rfc4627.txt).


## [v0.6.4] - 2015-04-14

#### Added
- [Configuration option](https://github.com/kahmali/meteor-restivus#useclientrouter) to disable Iron
  Router on the client (resolves Issue #24)

#### Changed
- Allow API to be configured and added to before Meteor starts (previously required within
  `Meteor.startup()`)


## [v0.6.3] - 2015-04-03

#### Fixed
- Issue #20: Allow [manual response](https://github.com/kahmali/meteor-restivus#thisresponse) in
  endpoints using underlying [Node response object](https://nodejs.org/api/http.html#http_class_http_serverresponse).


## [v0.6.2] - 2015-03-04

#### Fixed
- Issue #14: Prevent endpoints from being generated for any `excludedEndpoints` configured on
  collection routes (previously generated when no options were configured for any `endpoints`).
- Restivus.configure() is now bound to the Restivus object context

#### Added
- Basic set of Tinytests for testing configuration of an API and any of its routes
- Tests for Issue #14
- Support for Travis CI (build still failing although tests pass locally)


## [v0.6.1] - 2015-02-19
**_WARNING!_ API-breaking changes! Please be aware when upgrading!**

#### Fixed
- Allow existing collections to be added to API
  - v0.6.0 did not allow you to work with existing collections, or access collections created in
    Restivus elsewhere in your app, which is not the intended behavior. Since Meteor expects you to
    construct each collection only once (using `new Mongo.Collection()`), and store that globally,
    Restivus now requires that you pass an existing collection in `Restivus.addCollection()`,
    in place of the name.


## [v0.6.0] - 2015-02-17
**_WARNING!_ Do not use v0.6.0! Please upgrade to v0.6.1 or above.**
**_WARNING!_ API-breaking changes! Please be aware when upgrading!**

#### Added
- `Restivus.addCollection()` method for generating CRUD endpoints for Mongo Collections. Please
  see README for detailed information on defining collection routes in Restivus.

#### Changed
- **Rename `Restivus.add()` to `Restivus.addRoute()` for clarity, now that `Restivus.addCollection()`
  has been added to API. _Warning! This is an API-breaking change!_**
- **Convert all responses generated by Restivus to [JSend] format. _Warning! This is an API-breaking
  change!_**
- README
  - Update and refactor README to include detailed information on new collection route features,
    including code examples and an all-new Quick Start example that also highlights the new
    Restivus.addCollection() method.
  - Add "Terminology" section to the README for clarification on a few key terms that are heavily
    used throughout the docs
  - Add section on upgrading from v0.5.x


## [v0.5.9] - 2015-02-16

#### Added
- Allow user-defined OPTIONS endpoints on routes

#### Changed
- README
  - Show support for OPTIONS endpoints in description and code examples in the
    [Defining Endpoints] section of README


## [v0.5.8] - 2015-02-11

#### Added
- The following options have been added in `Restivus.configure()` to allow for custom user
  authentication on endpoints (see [Configuration Options] for a much more detailed breakdown):
    - `auth.token`: The path to the auth token in the `Meteor.user` document
    - `auth.user`: A function providing one of two levels of authentication, depending on the data
      it returns. Once the user authentication completes successfully, the authenticated user and
      their ID will be attached to the [endpoint context].

#### Changed
- README
  - Add `auth.token` and `auth.user` to [Configuration Options]


## [v0.5.7] - 2015-02-02

#### Fixed
- Resolve and configure endpoints in Route.addToApi() instead of Route constructor so that endpoints
  are never configured until the API has been configured (with Restivus.configure()). This was
  causing unexpected behavior in routes that were added before the API was configured, such as
  authentication not being checked when necessary (so this.user and this.userId were undefined in
  authenticated endpoints).

#### Changed
- README
  - Update [Quick Start] examples so Restivus is configured and built from within the
    Meteor.startup() callback
  - Add "Important!" note in the [Configuration][configuration options] and [Defining Routes]
    sections that these must be done within the Meteor.startup() callback


## [v0.5.6] - 2015-01-31

#### Fixed
- Issue #2: Make Restivus.\_initAuth() private only by convention for proper context. Context was
  accidentally altered when refactoring Restivus into a class in latest update.


## [v0.5.5] - 2015-01-30

#### Added
- User role permissions for limiting access to endpoints (works alongside the `alanning:roles`
  package)

#### Changed
- Resolve and configure endpoints during Route construction, to prevent a bunch of unnecessary
  processing every time an endpoint was being accessed. This should yield at least a minor
  performance gain on all endpoints.
- Refactor Route and Restivus into CoffeeScript classes
- README
  - Add info on setting up role permissions to [Route Options] and [Defining Endpoints] sections
  - Update [Quick Start] example to show definition of role permissions on an endpoint


## [v0.5.4] - 2015-01-27

#### Fixed
- Issue #1: The default api path ('api/') is used if no apiPath is provided in Restivus.configure()
  (would previously crash Meteor).
- Only a `config.apiPath` that is missing the trailing '/' will have it appended during API
  configuration


## [v0.5.3] - 2015-01-15

#### Fixed
- Context in onLoggedIn and onLoggedOut hooks is now the same as within an
  [authenticated endpoint][endpoint context]

#### Added
- Access `this.userId` within authenticated endpoints

#### Changed
- README
  - Add `this.userId` to [Endpoint Context]
  - [Specify context][configuration options] in `onLoggedIn` and `onLoggedOut` hooks


## [v0.5.2] - 2015-01-14

#### Fixed
- Prevent endpoint from being called if authentication fails (and return 401)

#### Added
- Support pretty JSON in API configuration

#### Changed
- README
  - Show endpoint object in 'Quick Start' code examples
  - Restructure topic hierarchy
  - Change 'Route Structure' section to 'Path Structure' and reword for consistent use of
    terminology
  - Add `prettyJson` to [Configuration Options]


## [v0.5.1] - 2015-01-10

#### Fixed
- `Content-Type` header in endpoint response will default to `text/json` if not overridden by user

#### Added
- Allow cross-domain requests to API from browsers (CORS-compliant)

#### Changed
- README
  - Clean up code examples
  - Add section on documenting API with apiDoc
  - Specify supported Meteor version
  - Add section on default http response configuration
  - Make it more readable in plain-text format
- Terminology (in code, comments, and README)
  - `Method`: The type of HTTP request (e.g., GET, PUT, POST, etc.)
  - `Endpoint`: The function executed when a request is made at a given path for a specific HTTP
    method
  - `Route`: A path and a set of endpoints


## [v0.5.0] - 2015-01-04
- Initial release



[v0.6.6]:  https://github.com/kahmali/meteor-restivus/compare/v0.6.5...v0.6.6 "Version 0.6.6"
[v0.6.5]:  https://github.com/kahmali/meteor-restivus/compare/v0.6.4...v0.6.5 "Version 0.6.5"
[v0.6.4]:  https://github.com/kahmali/meteor-restivus/compare/v0.6.3...v0.6.4 "Version 0.6.4"
[v0.6.3]:  https://github.com/kahmali/meteor-restivus/compare/v0.6.2...v0.6.3 "Version 0.6.3"
[v0.6.2]:  https://github.com/kahmali/meteor-restivus/compare/v0.6.1...v0.6.2 "Version 0.6.2"
[v0.6.1]:  https://github.com/kahmali/meteor-restivus/compare/v0.6.0...v0.6.1 "Version 0.6.1"
[v0.6.0]:  https://github.com/kahmali/meteor-restivus/compare/v0.5.9...v0.6.0 "Version 0.6.0"
[v0.5.9]:  https://github.com/kahmali/meteor-restivus/compare/v0.5.8...v0.5.9 "Version 0.5.9"
[v0.5.8]:  https://github.com/kahmali/meteor-restivus/compare/v0.5.7...v0.5.8 "Version 0.5.8"
[v0.5.7]:  https://github.com/kahmali/meteor-restivus/compare/v0.5.6...v0.5.7 "Version 0.5.7"
[v0.5.6]:  https://github.com/kahmali/meteor-restivus/compare/v0.5.5...v0.5.6 "Version 0.5.6"
[v0.5.5]:  https://github.com/kahmali/meteor-restivus/compare/v0.5.4...v0.5.5 "Version 0.5.5"
[v0.5.4]:  https://github.com/kahmali/meteor-restivus/compare/v0.5.3...v0.5.4 "Version 0.5.4"
[v0.5.3]:  https://github.com/kahmali/meteor-restivus/compare/v0.5.2...v0.5.3 "Version 0.5.3"
[v0.5.2]:  https://github.com/kahmali/meteor-restivus/compare/v0.5.1...v0.5.2 "Version 0.5.2"
[v0.5.1]:  https://github.com/kahmali/meteor-restivus/compare/v0.5.0...v0.5.1 "Version 0.5.1"
[v0.5.0]:  https://github.com/kahmali/meteor-restivus/compare/d4ae97...v0.5.0 "Version 0.5.0"

[quick start]:                   https://github.com/kahmali/meteor-restivus#quick-start                 "Quick Start"
[defining routes]:               https://github.com/kahmali/meteor-restivus#defining-custom-routes      "Defining Custom Routes"
[defining collection routes]:    https://github.com/kahmali/meteor-restivus#defining-routes             "Defining Collection Routes"
[configuration options]:         https://github.com/kahmali/meteor-restivus#configuration-options       "Configuration Options"
[endpoint context]:              https://github.com/kahmali/meteor-restivus#endpoint-context            "Endpoint Context"
[defining endpoints]:            https://github.com/kahmali/meteor-restivus#defining-endpoints          "Defining Endpoints"
[route options]:                 https://github.com/kahmali/meteor-restivus#route-options               "Route Options"
[jsend]:                         http://labs.omniti.com/labs/jsend                                      "JSend REST API Standard"
